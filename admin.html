<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard | LIKITH Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: monospace; }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid #334155;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="p-10">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-yellow-400 flex items-center gap-3">
                <i data-lucide="shield-alert"></i> ADMIN PROTOCOL :: MESSAGES
            </h1>
            <button onclick="fetchMessages()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded font-bold transition">
                REFRESH DATA
            </button>
        </div>

        <div class="glass-panel rounded-xl overflow-hidden">
            <table class="w-full text-left text-sm">
                <thead class="bg-slate-800 text-yellow-400 uppercase tracking-wider">
                    <tr>
                        <th class="p-4">ID</th>
                        <th class="p-4">Date</th>
                        <th class="p-4">Name</th>
                        <th class="p-4">Mobile</th>
                        <th class="p-4">Email</th>
                        <th class="p-4 w-1/3">Message</th>
                    </tr>
                </thead>
                <tbody id="table-body" class="divide-y divide-slate-700">
                    <tr><td colspan="6" class="p-8 text-center text-slate-500">Authenticating...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const SECRET_CODE = "Likith@2006"; 

        async function init() {
            const password = prompt("ENTER ADMIN PROTOCOL PASSWORD:");
            if (password !== SECRET_CODE) {
                alert("ACCESS DENIED.");
                document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:20%'>ACCESS DENIED // TERMINAL LOCKED</h1>";
                return;
            }
            fetchMessages();
        }

        async function fetchMessages() {
            try {
                const response = await fetch('http://localhost:5000/admin/messages');
                const data = await response.json();
                
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';

                if(data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="p-8 text-center text-slate-500">No signals received yet.</td></tr>';
                    return;
                }

                data.forEach(row => {
                    const date = new Date(row.timestamp).toLocaleString();
                    const tr = `
                        <tr class="hover:bg-slate-800/50 transition">
                            <td class="p-4 font-mono text-slate-500">#${row.id}</td>
                            <td class="p-4 text-xs text-slate-400">${date}</td>
                            <td class="p-4 font-bold text-white">${row.name}</td>
                            <td class="p-4 text-green-400 font-mono">${row.mobile || 'N/A'}</td>
                            <td class="p-4 text-blue-400 hover:underline"><a href="mailto:${row.email}">${row.email}</a></td>
                            <td class="p-4 text-slate-300">${row.message}</td>
                        </tr>
                    `;
                    tbody.innerHTML += tr;
                });

            } catch (error) {
                console.error(error);
                alert("Server Connection Failed. Is 'node server.js' running?");
            }
        }
        setTimeout(init, 500);
    </script>
</body>
</html>
